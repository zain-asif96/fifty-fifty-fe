import{K as L,r as y,k as O,d as R,A as U,c as p,a,u as n,w as g,H as $,b as h,O as V,o as u,g as D,l as E,t as x,f as P}from"./app-db97278d.js";import{u as j}from"./useAPI-5d208629.js";import{u as S}from"./notification-acac295e.js";import{c as G}from"./currencies-7c039667.js";import{c as k}from"./currencies_countries-fbccd8be.js";import{_ as H}from"./Spinner-c1a705af.js";import{N as w}from"./NewActionButton-b46bcee5.js";import{_ as K}from"./NewTextInput-f00b3737.js";import{_ as q}from"./NewSelectInput-293ca775.js";import{_ as M}from"./FiftyText-b13f5419.js";/* empty css                                                */import"./_plugin-vue_export-helper-c27b6911.js";/* empty css                                                     */const z={class:"transaction-info-form-wrapper"},J={key:0,class:"receiver-gets-wrapper m-auto"},Q={class:"receiver-gets"},W={key:1,class:"amount"},X={class:"action-buttons"},Y={name:"PaymentInformationForm"},ye=Object.assign(Y,{props:{user:{required:!0,default:null,type:Object},receivingCountries:{required:!0,default:[],type:Array}},emits:["stepChanged"],setup(f,{emit:Z}){const c=f,o=j(),l=S(),N=L().props.geoDetails,d=y(!1),m=y(0),s=y(!1),e=O({amount:"",currency:k[N.country_code],country:""}),A=async()=>{o.startRequest();try{const r=await axios.post("/api/collect-payment-info",e);r.data.status==="success"?B("/receiver-info?payment-reference-identification="+r.data.paymentIntent.id+"&country="+e.country):l.notify("Unexpected error happen","error")}catch(r){o.handleErrors(r),l.notify("Invalid data submitted","error")}finally{o.requestCompleted()}},v=async()=>{d.value=!0;const r=c.receivingCountries.find(t=>t.code_iso_2===e.country||t.code===e.country);try{const t=await axios.post("/api/convert-currency",{baseCurrency:e.currency,requiredCurrency:r.currency.code});m.value=t==null?void 0:t.data[r.currency.code].value}catch{l.notify("Exchange rate is not available at the moment..","error")}finally{d.value=!1}},B=r=>{V.get(r)},F=()=>{e.amount=parseFloat((c.user.handled_transaction.payment_intent.amount_in_receiver_currency/100).toFixed(2)),e.country=c.user.handled_transaction.user.country};R(()=>{s.value=!!c.user.transaction_id,s.value&&F()});const I=()=>{V.visit("/")},T=U(()=>parseFloat((m.value*e.amount).toFixed(2)));return(r,t)=>{var _,C,b;return u(),p("div",z,[a(K,{modelValue:e.amount,"onUpdate:modelValue":t[0]||(t[0]=i=>e.amount=i),disabled:s.value,errors:(_=n(o).errors.value)==null?void 0:_.amount,label:"Amount",placeholder:"99",required:"",title:"amount",class:"fifty-form-input",type:"number"},null,8,["modelValue","disabled","errors"]),a(q,{modelValue:e.currency,"onUpdate:modelValue":[t[1]||(t[1]=i=>e.currency=i),v],disabled:s.value,errors:(C=n(o).errors.value)==null?void 0:C.currency,options:n(G),label:"Currency",placeholder:"Currency of your payment card",required:"",title:"country",class:"fifty-form-input",type:"text"},null,8,["modelValue","disabled","errors","options"]),a(q,{modelValue:e.country,"onUpdate:modelValue":[t[2]||(t[2]=i=>e.country=i),v],disabled:s.value,errors:(b=n(o).errors.value)==null?void 0:b.country,options:f.receivingCountries,label:"Receiver Country","label-accessor":"label",placeholder:"Country",required:"",title:"country",class:"fifty-form-input country",type:"text","value-accessor":"code_iso_2"},null,8,["modelValue","disabled","errors","options"]),a($,{mode:"out-in",name:"fade"},{default:g(()=>[m.value&&e.amount?(u(),p("div",J,[h("div",Q,[a(M,{class:"title"},{default:g(()=>[D(" The receiver will get approximately ")]),_:1}),d.value?(u(),E(H,{key:0})):(u(),p("div",W,x(n(T))+" "+x(n(k)[e.country]),1))])])):P("",!0)]),_:1}),h("div",X,[a(w,{reversed:!0,type:"button",title:"Cancel",onClick:I}),a(w,{isLoading:n(o).isLoading.value,type:"button",title:"Continue",onClick:A},null,8,["isLoading"])])])}}});export{ye as default};
